<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcard Creator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --background-color: #ecf0f1;
            --card-color: #ffffff;
            --text-color: #34495e;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .app-container {
            display: flex;
            gap: 30px;
        }
        .form-container, .preview-container {
            flex: 1;
            background-color: var(--card-color);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: all 0.3s ease;
        }
        h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
        }
        .flashcard-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        input[type="file"] {
            margin-top: 5px;
        }
        button {
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 16px;
        }
        button:hover {
            background-color: #2980b9;
        }
        #generateFromPython {
            background-color: var(--secondary-color);
        }
        #generateFromPython:hover {
            background-color: #27ae60;
        }
        .flashcard {
            background-color: var(--card-color);
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .flashcard:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .flashcard-image {
            max-width: 100%;
            height: auto;
            margin-top: 10px;
            border-radius: 4px;
        }
        #pythonCode {
            width: 100%;
            height: 150px;
            font-family: monospace;
            resize: vertical;
        }
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Flashcard Creator</h1>
        
        <div class="app-container">
            <div class="form-container">
                <h2>Create Flashcards</h2>
                <form id="flashcardForm" class="flashcard-form">
                    <input type="text" id="front" placeholder="Front of the card" required>
                    <input type="file" id="image" accept="image/*">
                    <textarea id="back" rows="3" placeholder="Back of the card" required></textarea>
                    <button type="submit">Add Flashcard</button>
                </form>
                
                <h2>Generate from Python</h2>
                <textarea id="pythonCode" placeholder="Enter Python code to generate flashcards. Use the format: flashcards = [{'front': 'Front text', 'back': 'Back text'}, ...]"></textarea>
                <button id="generateFromPython">Generate from Python</button>
            </div>
            
            <div class="preview-container">
                <h2>Your Flashcards</h2>
                <div class="export-buttons">
                    <button id="exportBtn">Export to CSV</button>
                    <button id="exportAnkiBtn">Export to Anki</button>
                </div>
                <div id="flashcardList"></div>
            </div>
        </div>
    </div>

    <script>
        let flashcards = [];

        document.getElementById('flashcardForm').addEventListener('submit', addFlashcard);
        document.getElementById('exportBtn').addEventListener('click', exportToCSV);
        document.getElementById('exportAnkiBtn').addEventListener('click', exportToAnki);
        document.getElementById('generateFromPython').addEventListener('click', generateFromPython);

        function addFlashcard(e) {
            e.preventDefault();
            const front = document.getElementById('front').value;
            const back = document.getElementById('back').value;
            const imageFile = document.getElementById('image').files[0];
            
            if (front && back) {
                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        flashcards.push({front, back, image: event.target.result, imageName: imageFile.name});
                        updateFlashcardList();
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    flashcards.push({front, back, image: null, imageName: null});
                    updateFlashcardList();
                }
                document.getElementById('flashcardForm').reset();
            } else {
                alert('Please fill in both front and back of the card.');
            }
        }

        function updateFlashcardList() {
            const list = document.getElementById('flashcardList');
            list.innerHTML = '';
            flashcards.forEach((card, index) => {
                let imageHtml = card.image ? `<img src="${card.image}" class="flashcard-image" alt="Flashcard image">` : '';
                list.innerHTML += `
                    <div class="flashcard">
                        <h3>Flashcard ${index + 1}</h3>
                        <p><strong>Front:</strong> ${card.front}</p>
                        ${imageHtml}
                        <p><strong>Back:</strong> ${card.back}</p>
                    </div>
                `;
            });
        }

        function generateFromPython() {
            const pythonCode = document.getElementById('pythonCode').value;
            try {
                const parsedCode = pythonCode.match(/flashcards\s*=\s*(\[.*\])/s);
                if (parsedCode) {
                    const flashcardsData = JSON.parse(parsedCode[1].replace(/'/g, '"'));
                    flashcards = flashcards.concat(flashcardsData);
                    updateFlashcardList();
                    alert(`${flashcardsData.length} flashcards generated from Python code.`);
                } else {
                    alert('Invalid Python code format. Please use the format: flashcards = [{"front": "Front text", "back": "Back text"}, ...]');
                }
            } catch (error) {
                alert('Error parsing Python code. Please check your syntax.');
                console.error(error);
            }
        }

        function exportToCSV() {
            let csvContent = "data:text/csv;charset=utf-8,";
            flashcards.forEach(card => {
                let frontContent = card.front.replace(/,/g, "");
                if (card.image) {
                    frontContent += ` [Image included]`;
                }
                csvContent += `${frontContent},${card.back.replace(/,/g, "")}\n`;
            });
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "flashcards.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportToAnki() {
            const zip = new JSZip();
            let mediaFiles = {};
            let mediaCounter = 0;

            // Create collection.anki2 file (SQLite database, we'll use a minimal structure)
            const collectionSql = `
            CREATE TABLE cards (
                id INTEGER PRIMARY KEY,
                nid INTEGER NOT NULL,
                did INTEGER NOT NULL,
                ord INTEGER NOT NULL,
                mod INTEGER NOT NULL,
                usn INTEGER NOT NULL,
                type INTEGER NOT NULL,
                queue INTEGER NOT NULL,
                due INTEGER NOT NULL,
                ivl INTEGER NOT NULL,
                factor INTEGER NOT NULL,
                reps INTEGER NOT NULL,
                lapses INTEGER NOT NULL,
                left INTEGER NOT NULL,
                odue INTEGER NOT NULL,
                odid INTEGER NOT NULL,
                flags INTEGER NOT NULL,
                data TEXT NOT NULL
            );
            CREATE TABLE notes (
                id INTEGER PRIMARY KEY,
                guid TEXT NOT NULL,
                mid INTEGER NOT NULL,
                mod INTEGER NOT NULL,
                usn INTEGER NOT NULL,
                tags TEXT NOT NULL,
                flds TEXT NOT NULL,
                sfld INTEGER NOT NULL,
                csum INTEGER NOT NULL,
                flags INTEGER NOT NULL,
                data TEXT NOT NULL
            );
            `;
            zip.file("collection.anki2", collectionSql);

            // Create cards content
            let cardsContent = "";
            flashcards.forEach((card, index) => {
                let frontContent = card.front;
                if (card.image) {
                    mediaCounter++;
                    const fileName = `image${mediaCounter}${getFileExtension(card.imageName)}`;
                    mediaFiles[mediaCounter] = fileName;
                    zip.file(fileName, card.image.split(',')[1], {base64: true});
                    frontContent += `<br><img src="${fileName}">`;
                }
                cardsContent += `${frontContent}\t${card.back}\n`;
            });

            // Add cards file to zip
            zip.file("notes.txt", cardsContent);

            // Create and add media file to zip
            let mediaContent = JSON.stringify(mediaFiles);
            zip.file("media", mediaContent);

            // Create minimal deck structure
            const deckStructure = {
                "1": {
                    "desc": "",
                    "name": "Imported Deck",
                    "extendRev": 50,
                    "usn": 0,
                    "collapsed": false,
                    "newToday": [0, 0],
                    "timeToday": [0, 0],
                    "dyn": 0,
                    "extendNew": 10,
                    "conf": 1,
                    "revToday": [0, 0],
                    "lrnToday": [0, 0],
                    "id": 1,
                    "mod": 1599345417
                }
            };
            zip.file("deck", JSON.stringify(deckStructure));

            // Generate and download the zip file
            zip.generateAsync({type:"blob"})
            .then(function(content) {
                saveAs(content, "anki_flashcards.apkg");
            });
        }

        function getFileExtension(filename) {
            return filename.slice((filename.lastIndexOf(".") - 1 >>> 0) + 2);
        }
    </script>
</body>
</html>
